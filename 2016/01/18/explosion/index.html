<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      绚丽的爆炸动画——ExplosionField | DoubleChen，就这样 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="Double Chen">
    
    

    <meta name="description" content="简介Github上有一个很炫酷的动画开源项目——ExplosionField。">
<meta property="og:type" content="article">
<meta property="og:title" content="绚丽的爆炸动画——ExplosionField | DoubleChen，就这样">
<meta property="og:url" content="http://yoursite.com/2016/01/18/explosion/index.html">
<meta property="og:site_name" content="DoubleChen，就这样">
<meta property="og:description" content="简介Github上有一个很炫酷的动画开源项目——ExplosionField。">
<meta property="og:image" content="http://yoursite.com/Explosion/explosion.gif">
<meta property="og:image" content="http://yoursite.com/Explosion/explosion_flow.png">
<meta property="og:updated_time" content="2016-01-20T09:54:04.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="绚丽的爆炸动画——ExplosionField | DoubleChen，就这样">
<meta name="twitter:description" content="简介Github上有一个很炫酷的动画开源项目——ExplosionField。">
    
    
    
      <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    
    <link rel="stylesheet" href="/css/uno.css" type="text/css">
    <link rel="stylesheet" href="/css/highlight.css" type="text/css">
    <link rel="stylesheet" href="/css/archive.css" type="text/css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        
        <a href="/" title="link to homepage for DoubleChen，就这样"><img src="/images/avatar.png" width="80" alt="DoubleChen，就这样 logo" class="panel-cover__logo logo" /></a>
        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">DoubleChen，就这样</a></h1>
        <hr class="panel-cover__divider" />

        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">首页</a></li>
              
                
                <li class="navigation__item"><a href="/archives" title="" class="">归档</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">绚丽的爆炸动画——ExplosionField</h1>

    

    <div class="post-meta">
      <time datetime="2016-01-18" class="post-meta__date date">2016-01-18</time> 

      <span class="post-meta__tags tags">

          

          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/Explosion/">Explosion</a>, <a class="tags-link" href="/tags/android/">android</a>, <a class="tags-link" href="/tags/animation/">animation</a>
            </font>
          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <h2 id="简介">简介</h2><p>Github上有一个很炫酷的动画开源项目——<a href="https://github.com/Love5209/ExplosionField" target="_blank" rel="external">ExplosionField</a>。<br><img src="/Explosion/explosion.gif" alt="explosion">    </p>
<a id="more"></a>
<p>MIUI的一些版本卸载APP的特效就是用的这个爆炸。<br>Explosion不止效果惊人，代码也极其简洁精妙，核心代码加起来还不到300行，让人忍不住一窥。</p>
<h2 id="流程图">流程图</h2><p><img src="/Explosion/explosion_flow.png" alt="explosion_flow">    </p>
<h2 id="代码浅析">代码浅析</h2><h3 id="ExplosionField">ExplosionField</h3><p>ExplosionField是一个View，这个View的作用就是用来绘制爆炸效果。<br>它提供了一个静态的初始化方法——<em>attach2Window</em>：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExplosionField <span class="title">attach2Window</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">	ViewGroup rootView = (ViewGroup) activity.findViewById(Window.ID_ANDROID_CONTENT);</span><br><span class="line">	ExplosionField explosionField = <span class="keyword">new</span> ExplosionField(activity);</span><br><span class="line">	rootView.addView(explosionField, <span class="keyword">new</span> ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT,</span><br><span class="line">			ViewGroup.LayoutParams.MATCH_PARENT));</span><br><span class="line">	<span class="keyword">return</span> explosionField;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个方法在初始化的同时，将初始化得到的ExplosionField作为一个子View添加到了Activity的root上面。<br>因为Activity中的任何View都可以实现爆炸效果，所以，我们的ExplosionField的LayoutParams属性都被设置为<strong>MATCH_PARENT</strong>，这样爆炸产生的例子就能绘制在整个Activity上面了。<br>可以看到，这边用Window.ID_ANDROID_CONTENT来替代常用的android.R.id.content。<br>在MainActivity里面看到，每个View都被设置了点击事件，点击后就会调用<em>mExplosionField.explode(v)</em>，触发了爆炸流程。</p>
<h3 id="爆炸范围的获取">爆炸范围的获取</h3><p>我们看explode的前几行：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Rect r = <span class="keyword">new</span> Rect();</span><br><span class="line"><span class="comment">// 获取需要爆炸的View的全局可见区域</span></span><br><span class="line">view.getGlobalVisibleRect(r);</span><br><span class="line"><span class="keyword">int</span>[] location = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line"><span class="comment">//  获取ExplosionField在屏幕中的坐标</span></span><br><span class="line">getLocationOnScreen(location);</span><br><span class="line"><span class="comment">// 根据ExplosionField在屏幕中的坐标平移爆炸View的可视区域</span></span><br><span class="line">r.offset(-location[<span class="number">0</span>], -location[<span class="number">1</span>]);</span><br><span class="line"><span class="comment">// 扩展爆炸View的可视区域，这个区域最终用来显示四散的粒子</span></span><br><span class="line">r.inset(-mExpandInset[<span class="number">0</span>], -mExpandInset[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure></p>
<p>这几行代码获取了需要爆炸的View位置以及可见区域，再通过Rect的offset方法和inset方法定义了View爆炸时粒子的动画范围。</p>
<h3 id="View的震颤">View的震颤</h3><p>苹果的APP删除时，都会有一个颤抖效果，以表达APP的恐惧之情。<br>估计作者受了启发，View爆炸前都先让它震颤一会儿。<br>震颤的代码相当简单：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> startDelay = <span class="number">100</span>;</span><br><span class="line">ValueAnimator animator = ValueAnimator.ofFloat(<span class="number">0f</span>, <span class="number">1f</span>).setDuration(<span class="number">150</span>);</span><br><span class="line">animator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line"></span><br><span class="line">	Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">		view.setTranslationX((random.nextFloat() - <span class="number">0.5f</span>) * view.getWidth() * <span class="number">0.05f</span>);</span><br><span class="line">		view.setTranslationY((random.nextFloat() - <span class="number">0.5f</span>) * view.getHeight() * <span class="number">0.05f</span>);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">animator.start();</span><br><span class="line">view.animate().setDuration(<span class="number">150</span>).setStartDelay(startDelay).scaleX(<span class="number">0f</span>).scaleY(<span class="number">0f</span>).alpha(<span class="number">0f</span>).start();</span><br></pre></td></tr></table></figure></p>
<p>先设置了一个持续150ms的动画，这个动画是让View随机移动，同时移动x和y，非常简单，几行代码就可以让一个View震啊震。<br>震动了100ms后（<em>startDelay</em>变量控制），将View的scale和alpha值动态减为0，实现了隐藏效果。<br>两个动画叠加，就产生了View的震颤动画。</p>
<h3 id="根据View创建Bitmap">根据View创建Bitmap</h3><p>我们可以看到，爆炸效果是将整个View分割成一个一个小粒子再四散，要实现这个效果，我们首先需要获取View对应的Bitmap。<br>这个过程通过Utils类的<em>createBitmapFromView</em>实现。<br>如果VIew是ImageView而且对应的Drawable是BitmapDrawable的话，就可以直接获取这个View对应的Bitmap：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (view <span class="keyword">instanceof</span> ImageView) &#123;</span><br><span class="line">	Drawable drawable = ((ImageView) view).getDrawable();</span><br><span class="line">	<span class="keyword">if</span> (drawable != <span class="keyword">null</span> &amp;&amp; drawable <span class="keyword">instanceof</span> BitmapDrawable) &#123;</span><br><span class="line">		<span class="keyword">return</span> ((BitmapDrawable) drawable).getBitmap();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>别的情况下，获取一个Bitmap的过程就稍微一点复杂了：</p>
<ol>
<li>新建一个Canvas</li>
<li>新建一个跟View等宽高的空Bitmap</li>
<li>将空Bitmap设为Canvas的底布</li>
<li>将View绘制到Canvas上面</li>
<li>将Canvas的底布清空</li>
</ol>
<p>这个过程一走完，我们的Bitmap就已经成为了View的模样。<br>当然，绘制之前要清掉View的焦点，因为焦点可能会改变一个View的UI状态。<br>同时，Canvas用的是静态变量，这样做的好处是节省了每次创建绘制环境的开销。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">view.clearFocus();</span><br><span class="line">Bitmap bitmap = createBitmapSafely(view.getWidth(), view.getHeight(), Bitmap.Config.ARGB_8888, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (bitmap != <span class="keyword">null</span>) &#123;</span><br><span class="line">	<span class="keyword">synchronized</span> (sCanvas) &#123;</span><br><span class="line">		Canvas canvas = sCanvas;</span><br><span class="line">		canvas.setBitmap(bitmap);</span><br><span class="line">		view.draw(canvas);</span><br><span class="line">		canvas.setBitmap(<span class="keyword">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在根据View获取Bitmap的过程中，作者还考虑到了OOM的情况，所以封装了一个<em>createBitmapSafely</em>方法。<br>如果出现了OOM的情况，就主动调用系统的gc方法，然后重新尝试绘制。<br>同时，为了避免无限尝试，还设定了一个retryCount的变量。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Bitmap <span class="title">createBitmapSafely</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height, Bitmap.Config config, <span class="keyword">int</span> retryCount)</span> </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> Bitmap.createBitmap(width, height, config);</span><br><span class="line">&#125; <span class="keyword">catch</span> (OutOfMemoryError e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">	<span class="keyword">if</span> (retryCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		System.gc();</span><br><span class="line">		<span class="keyword">return</span> createBitmapSafely(width, height, config, retryCount - <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在通过View获取Bitmap的过程中，我们看到了作者深厚的代码底蕴，除了对各系统API的精准使用，还极其注意细节，避免实际应用中出现的各种各样bug。</p>
<h3 id="爆炸动画触发">爆炸动画触发</h3><p>上面的各项准备工作完成后，就要触发真正的爆炸效果了：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">explode</span><span class="params">(Bitmap bitmap, Rect bound, <span class="keyword">long</span> startDelay, <span class="keyword">long</span> duration)</span> </span>&#123;</span><br><span class="line"><span class="keyword">final</span> ExplosionAnimator explosion = <span class="keyword">new</span> ExplosionAnimator(<span class="keyword">this</span>, bitmap, bound);</span><br><span class="line">explosion.addListener(<span class="keyword">new</span> AnimatorListenerAdapter() &#123;</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">		mExplosions.remove(animation);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">explosion.setStartDelay(startDelay);</span><br><span class="line">explosion.setDuration(duration);</span><br><span class="line">mExplosions.add(explosion);</span><br><span class="line">explosion.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这只是启动了爆炸动画，启动的过程中，我们看到了有一个容器变量——mExplosions。<br>mExplosions用来保存ExplosionAnimator，因为控件支持多个View同时爆炸，所以要把每个View对应的爆炸动画保存起来，动画结束后再从mExplosions中移除。</p>
<h3 id="爆炸动画类">爆炸动画类</h3><p>ExplosionAnimator继承了ValueAnimator，是整个爆炸效果的核心。<br>先看其构造方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ExplosionAnimator</span><span class="params">(View container, Bitmap bitmap, Rect bound)</span> </span>&#123;</span><br><span class="line">	mPaint = <span class="keyword">new</span> Paint();</span><br><span class="line">	mBound = <span class="keyword">new</span> Rect(bound);</span><br><span class="line">	<span class="keyword">int</span> partLen = <span class="number">15</span>;</span><br><span class="line">	mParticles = <span class="keyword">new</span> Particle[partLen * partLen];</span><br><span class="line">	Random random = <span class="keyword">new</span> Random(System.currentTimeMillis());</span><br><span class="line">	<span class="keyword">int</span> w = bitmap.getWidth() / (partLen + <span class="number">2</span>);</span><br><span class="line">	<span class="keyword">int</span> h = bitmap.getHeight() / (partLen + <span class="number">2</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; partLen; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; partLen; j++) &#123;</span><br><span class="line">			mParticles[(i * partLen) + j] = generateParticle(bitmap.getPixel((j + <span class="number">1</span>) * w, (i + <span class="number">1</span>) * h), random);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	mContainer = container;</span><br><span class="line">	setFloatValues(<span class="number">0f</span>, END_VALUE);</span><br><span class="line">	setInterpolator(DEFAULT_INTERPOLATOR);</span><br><span class="line">	setDuration(DEFAULT_DURATION);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到，构造函数里面，把我们之前View对应的Bitmap分成了17<em>17的矩阵，同时，取中间的15</em>15作为爆炸时的粒子。<br>每个位置粒子的颜色，通过<em>bitmap.getPixel((j + 1) </em> w, (i + 1) <em> h)</em>获取。<br>ExplosionAnimator重载了<em>start()</em>方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Override</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">super</span>.start();</span><br><span class="line">	mContainer.invalidate(mBound);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个mContainer就是我们的ExplosionField，我们再看看看ExplosionField的draw方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">	<span class="keyword">for</span> (ExplosionAnimator explosion : mExplosions) &#123;</span><br><span class="line">		explosion.draw(canvas);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>原来又调回了ExplosionAnimator，调用了ExplosionAnimator的draw方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!isStarted()) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (Particle particle : mParticles) &#123;</span><br><span class="line">		particle.advance((Float) getAnimatedValue());</span><br><span class="line">		<span class="keyword">if</span> (particle.alpha &gt; <span class="number">0f</span>) &#123;</span><br><span class="line">			mPaint.setColor(particle.color);</span><br><span class="line">			mPaint.setAlpha((<span class="keyword">int</span>) (Color.alpha(particle.color) * particle.alpha));</span><br><span class="line">			canvas.drawCircle(particle.cx, particle.cy, particle.radius, mPaint);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	mContainer.invalidate();</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这段代码，根据Animation的value，绘制了例子的位置，通过有调用<em>mContainer.invalidate()</em>，刷新了View。<br>这样就形成了一个递归，不停的刷新View，重绘例子，一直到动画完成，<em>isStarted()</em>变为false，爆炸效果就完成了。</p>
<h3 id="粒子绘制">粒子绘制</h3><p>作者定义了一个粒子类——Particle。<br>这个类的生成及动画过程中的绘制方法，我没看懂，作者也没有多加解释。<br>爆炸过程中，粒子如烟花般四散，这个过程，没有深厚的动画经验是无法写出，我敢肯定，作者不是普通的应用开发者，肯定有游戏相关开发经验。</p>
<h2 id="其他">其他</h2><p>这个开源库的一些变量可以单独提取，成为一个设置类，使动画效果可控，例如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExplosionSetting</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">long</span> shakeAndShadeDuration = <span class="number">150</span>; <span class="comment">//震动及其渐变时长 毫秒</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> shakeRange =<span class="number">0.05f</span>; <span class="comment">//震动幅度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">long</span> explosionDuration =<span class="number">0x400</span>; <span class="comment">//爆炸时长</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> partLen=<span class="number">15</span>; <span class="comment">//矩阵长宽，个数：粒子*粒子</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> expandInset=<span class="number">10</span>; <span class="comment">//爆炸范围</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> radius = <span class="number">2</span>; <span class="comment">//粒子半径</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ExplosionSetting</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>国内有个同行根据源码，写出了通俗易懂的自己的例子，也很不错。<br><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/1204/3747.html" target="_blank" rel="external">学习ExplosionField之粒子破碎效果</a></p>

  </section>

  
  
</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2014-2015. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
